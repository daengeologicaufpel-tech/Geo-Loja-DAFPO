<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAFPO - Loja Geológica</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Work+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        :root{--verde-principal:#3A5A40;--marrom-principal:#A0522D;--cor-fundo-claro:#F4F1EA;--cor-fundo-escuro:#252525;--cor-texto-claro:#EFEFEF;--cor-texto-escuro:#333333}*{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body{background-color:var(--cor-fundo-claro);color:var(--cor-texto-escuro);font-family:"Work Sans",sans-serif}.container{margin:0 auto;max-width:1200px;padding:0 20px}.main-header{background-color:var(--cor-fundo-escuro);border-bottom:3px solid var(--verde-principal);padding:15px 0;position:relative}.header-container{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.main-header .logo{height:50px}.main-header .logo img{display:block;height:100%}.header-nav ul{display:-webkit-box;display:-ms-flexbox;display:flex;gap:25px;list-style:none}.header-nav a{color:var(--cor-texto-claro);font-size:1rem;font-weight:700;letter-spacing:1px;padding:5px 0;text-decoration:none;-webkit-text-decoration-skip:objects;text-transform:uppercase;-webkit-transition:color .3s ease;transition:color .3s ease}.header-nav a:hover{color:var(--verde-principal)}.hamburger-menu{background:0 0;border:none;color:#fff;cursor:pointer;display:none;font-size:1.8rem;z-index:1001}.mobile-nav-menu{display:none}.products-section{padding:50px 20px}.product-grid{display:grid;gap:30px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}.product-card{background-color:#fff;border-radius:4px;color:var(--cor-texto-escuro);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;overflow:hidden;-webkit-box-shadow:0 4px 15px rgba(0,0,0,.05);box-shadow:0 4px 15px rgba(0,0,0,.05);text-decoration:none;-webkit-text-decoration-skip:objects;-webkit-transition:-webkit-transform .3s ease,-webkit-box-shadow .3s ease;transition:transform .3s ease,box-shadow .3s ease}.product-card:hover{-webkit-transform:translateY(-8px);transform:translateY(-8px);-webkit-box-shadow:0 8px 25px rgba(0,0,0,.1);box-shadow:0 8px 25px rgba(0,0,0,.1)}.card-media{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#f7f7f7;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:relative}.card-media img{-o-object-fit:cover;object-fit:cover;aspect-ratio:1/1;display:block;height:auto;-webkit-transition:opacity .3s ease;transition:opacity .3s ease;width:100%}.card-media .card-media-hover{left:0;opacity:0;position:absolute;top:0}.product-card:hover .card-media-hover{opacity:1}.card-info{border-top:1px solid #eee;padding:20px 15px;text-align:left}.card-info h3{font-family:"Roboto Condensed",sans-serif;font-size:1.1rem;font-weight:700;margin-bottom:8px}.card-info .price{color:var(--marrom-principal);font-size:1rem;font-weight:700}.main-footer{background-color:var(--cor-fundo-escuro);color:var(--cor-texto-claro);margin-top:40px;padding:40px 0 20px}.footer-grid{display:grid;gap:30px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-bottom:30px}.footer-column h4{color:#fff;font-size:1.1rem;font-weight:700;letter-spacing:1px;margin-bottom:15px;text-transform:uppercase}.footer-column ul{list-style:none}.footer-column ul li{margin-bottom:8px}.footer-column a,.footer-column p{color:#ccc;font-size:.9rem;text-decoration:none;-webkit-text-decoration-skip:objects;-webkit-transition:color .3s ease;transition:color .3s ease}.footer-column a:hover{color:#fff}.payment-icons{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:8px}.payment-icons img{background-color:#fff;border-radius:3px;height:22px;padding:2px}.social-icons{display:-webkit-box;display:-ms-flexbox;display:flex;gap:15px}.social-icons a{color:#ccc;font-size:1.5rem;-webkit-transition:color .3s ease,-webkit-transform .3s ease;transition:color .3s ease,transform .3s ease}.social-icons a:hover{color:#fff;-webkit-transform:scale(1.1);transform:scale(1.1)}.footer-bottom{border-top:1px solid #444;color:#aaa;font-size:.8rem;padding-top:20px;text-align:center}
        .product-detail-grid {display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;}
        .product-image-container img {width: 100%; border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);}
        .product-info-container h1 {font-family: "Roboto Condensed", sans-serif; font-size: 2.5rem; margin-bottom: 15px; color: var(--cor-texto-escuro);}
        .product-info-container .price {font-size: 1.8rem; color: var(--marrom-principal); font-weight: 700; margin-bottom: 25px;}
        .product-info-container .description {line-height: 1.7; color: var(--cor-texto-escuro);}
        .product-info-container .description p {margin-bottom: 1em;}
        .product-image-slider { position: relative; overflow: hidden; border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); aspect-ratio: 1/1; }
        .slider-wrapper { display: flex; width: 200%; height: 100%; transition: transform 0.4s ease-in-out; }
        .slider-slide { width: 50%; height: 100%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; background-color: #f7f7f7; }
        .slider-slide img { width: 100%; height: 100%; object-fit: cover; }
        .slider-button { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.4); color: white; border: none; border-radius: 50%; width: 44px; height: 44px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; transition: background-color 0.3s ease; z-index: 10; }
        .slider-button:hover { background-color: rgba(0,0,0,0.7); }
        .slider-button.prev { left: 15px; }
        .slider-button.next { right: 15px; }

        /* --- NOVOS ESTILOS PARA O FORMULÁRIO DE PEDIDO --- */
        .order-form { margin-top: 40px; padding-top: 30px; border-top: 1px solid #ddd; }
        .order-form h3 { font-family: "Roboto Condensed", sans-serif; font-size: 1.5rem; text-transform: uppercase; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: 700; margin-bottom: 5px; font-size: 0.9rem; }
        .form-group select, .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; font-family: var(--font-body); }
        .order-button { display: block; width: 100%; background-color: var(--verde-principal); color: white; border: none; padding: 15px; border-radius: 4px; font-size: 1.1rem; font-weight: 700; text-transform: uppercase; cursor: pointer; transition: background-color 0.3s ease; }
        .order-button:hover { background-color: #2a4030; }

        @media (max-width:850px){.header-nav{display:none}.hamburger-menu{display:block}.header-container{position:relative;width:100%}.main-header .logo{-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);left:50%;position:absolute;top:50%}.mobile-nav-menu{-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:var(--cor-fundo-escuro);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:20px;height:calc(100vh - 84px);left:0;opacity:0;padding:40px 0;position:fixed;top:84px;-webkit-transform:translateY(-20px);transform:translateY(-20px);-webkit-transition:opacity .3s ease,visibility .3s ease,-webkit-transform .3s ease;transition:opacity .3s ease,visibility .3s ease,transform .3s ease;visibility:hidden;width:100%;z-index:1000}.mobile-nav-menu.is-active{opacity:1;-webkit-transform:translateY(0);transform:translateY(0);visibility:visible}.mobile-nav-menu a{color:#fff;font-size:1.2rem;font-weight:700;text-decoration:none;-webkit-text-decoration-skip:objects;text-transform:uppercase}.product-grid{gap:15px;grid-template-columns:repeat(2,1fr)}.card-info{padding:10px}.card-info h3{font-size:.9rem;margin-bottom:5px}.card-info .price{font-size:.9rem}.footer-grid{text-align:center}.social-icons,.payment-icons{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}
        .product-detail-grid {grid-template-columns: 1fr;} .product-info-container h1 {font-size: 1.8rem;} .product-info-container .price {font-size: 1.5rem;}}
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container header-container">
            <nav class="header-nav left-nav">
                <ul><li><a href="/#">Camisas</a></li><li><a href="/#">Moletons</a></li></ul>
            </nav>
            <div class="logo">
                <a href="/"><img src="/images/dafpo-logo.png" alt="Logo DAFPO"></a>
            </div>
            <nav class="header-nav right-nav">
                <ul><li><a href="/#">Acessórios</a></li><li><a href="/#">Sobre</a></li></ul>
            </nav>
            <button class="hamburger-menu" id="hamburger-btn" aria-label="Abrir menu"><i class="fas fa-bars"></i></button>
        </div>
    </header>
    <nav class="mobile-nav-menu" id="mobile-menu"><a href="/#">Camisas</a><a href="/#">Moletons</a><a href="/#">Acessórios</a><a href="/#">Sobre</a></nav>

    <main>
        <section class="products-section">
            <div class="container" id="product-detail-container">
                <p>Carregando produto...</p>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        </footer>

    <script>
        // --- ADICIONE SEU NÚMERO DE WHATSAPP AQUI ---
        // Inclua o código do país (55 para Brasil) e o DDD. Ex: 5553999998888
        const WHATSAPP_NUMBER = "5500000000000"; 
    
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        if (hamburgerBtn && mobileMenu) {
            const icon = hamburgerBtn.querySelector('i');
            hamburgerBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('is-active');
                icon.classList.toggle('fa-bars');
                icon.classList.toggle('fa-times');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const mainContentContainer = document.getElementById('product-detail-container');
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (slug && mainContentContainer) {
                const GITHUB_USER = "daengeologicaufpel-tech";
                const GITHUB_REPO = "Geo-Loja-DAFPO";
                const fileUrl = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/produtos/${slug}.md`;

                fetch(fileUrl)
                    .then(res => {
                        if (!res.ok) throw new Error('Produto não encontrado');
                        return res.text();
                    })
                    .then(content => {
                        const product = parseFrontmatter(content);
                        const bodyContent = content.split('---').slice(2).join('---').trim();
                        if (product) {
                            displayProductDetail(product, bodyContent);
                        } else {
                            throw new Error('Erro ao ler os dados do produto.');
                        }
                    })
                    .catch(error => {
                        console.error("Erro:", error);
                        mainContentContainer.innerHTML = `<p>Produto não encontrado. Verifique o link ou tente novamente.</p>`;
                    });
            } else {
                mainContentContainer.innerHTML = `<p>Nenhum produto selecionado.</p>`;
            }

            function parseFrontmatter(markdownContent) {
                const match = markdownContent.match(/---([\s\S]*?)---/);
                if (!match) return null;
                const frontmatter = {};
                const lines = match[1].trim().split('\n');
                lines.forEach(line => {
                    const separatorIndex = line.indexOf(':');
                    if (separatorIndex > -1) {
                        const key = line.slice(0, separatorIndex).trim();
                        const value = line.slice(separatorIndex + 1).trim().replace(/^['"]|['"]$/g, '');
                        frontmatter[key] = value;
                    }
                });
                return frontmatter;
            }

            function displayProductDetail(product, body) {
                document.title = `${product.titulo} - DAFPO Loja`;
                const descriptionHtml = body.split('\n').filter(p => p.trim() !== '').map(p => `<p>${p}</p>`).join('');
                
                let imageHtml = '';
                if (product.imagem_costas) {
                    imageHtml = `...`; // O código do slider, omitido por brevidade
                } else {
                    imageHtml = `<div class="product-image-container"><img src="${product.imagem_frente}" alt="${product.titulo}"></div>`;
                }

                // Lógica para criar o formulário dinamicamente
                let formHtml = `
                    <div class="order-form">
                        <h3>SOLICITAR PEDIDO</h3>
                `;

                if (product.tamanhos) {
                    const sizes = product.tamanhos.split(',').map(s => s.trim());
                    let sizeOptions = sizes.map(size => `<option value="${size}">${size}</option>`).join('');
                    formHtml += `
                        <div class="form-group">
                            <label for="tamanho-select">Tamanho:</label>
                            <select name="tamanho" id="tamanho-select">
                                ${sizeOptions}
                            </select>
                        </div>
                    `;
                }

                formHtml += `
                        <div class="form-group">
                            <label for="nome-completo">Nome Completo:</label>
                            <input type="text" id="nome-completo" name="nome" placeholder="Digite seu nome aqui">
                        </div>
                        <button id="whatsapp-button" class="order-button">Encaminhar Pedido</button>
                    </div>
                `;

                mainContentContainer.innerHTML = `
                    <div class="product-detail-grid">
                        ${imageHtml.replace('...', `
                            <div class="product-image-slider" id="product-slider">
                                <div class="slider-wrapper">
                                    <div class="slider-slide"><img src="${product.imagem_frente}" alt="${product.titulo} - Frente"></div>
                                    <div class="slider-slide"><img src="${product.imagem_costas}" alt="${product.titulo} - Costas"></div>
                                </div>
                                <button class="slider-button prev" aria-label="Anterior">&#10094;</button>
                                <button class="slider-button next" aria-label="Próximo">&#10095;</button>
                            </div>
                        `)}
                        <div class="product-info-container">
                            <h1>${product.titulo}</h1>
                            <p class="price">R$ ${product.preco}</p>
                            <div class="description">
                                ${descriptionHtml}
                            </div>
                            ${formHtml}
                        </div>
                    </div>
                `;

                if (product.imagem_costas) {
                    activateSlider();
                }
                // Ativa a lógica do formulário do WhatsApp, passando os dados do produto
                activateWhatsAppForm(product);
            }

            function activateSlider() {
                const slider = document.getElementById('product-slider');
                if (!slider) return;
                const wrapper = slider.querySelector('.slider-wrapper');
                const prevBtn = slider.querySelector('.prev');
                const nextBtn = slider.querySelector('.next');
                let currentIndex = 0;
                function updateSlider() { wrapper.style.transform = `translateX(-${currentIndex * 50}%)`; }
                nextBtn.addEventListener('click', () => { currentIndex = (currentIndex + 1) % 2; updateSlider(); });
                prevBtn.addEventListener('click', () => { currentIndex = (currentIndex - 1 + 2) % 2; updateSlider(); });
            }

            // --- NOVA FUNÇÃO PARA ATIVAR O FORMULÁRIO DO WHATSAPP ---
            function activateWhatsAppForm(product) {
                const whatsappButton = document.getElementById('whatsapp-button');
                if (!whatsappButton) return;

                whatsappButton.addEventListener('click', () => {
                    const nomeInput = document.getElementById('nome-completo');
                    const tamanhoSelect = document.getElementById('tamanho-select');

                    const nome = nomeInput.value.trim();
                    if (!nome) {
                        alert('Por favor, preencha seu nome completo.');
                        nomeInput.focus();
                        return;
                    }

                    // Se o seletor de tamanho existir, pegue o valor. Senão, defina como 'Tamanho Único'.
                    const tamanho = tamanhoSelect ? tamanhoSelect.value : 'Tamanho Único';
                    
                    const produtoNome = product.titulo;
                    const produtoPreco = product.preco;

                    // Monta a mensagem para o WhatsApp
                    const mensagem = `Olá! Tenho interesse em um produto da GeoLoja:\n\n*Produto:* ${produtoNome}\n*Tamanho:* ${tamanho}\n*Preço:* R$ ${produtoPreco}\n\n*Meu Nome:* ${nome}\n\nAguardando contato para finalizar o pedido. Obrigado!`;
                    
                    // Cria a URL do WhatsApp
                    const whatsappUrl = `https://wa.me/${+555399024007}?text=${encodeURIComponent(mensagem)}`;
                    
                    // Abre o WhatsApp em uma nova aba
                    window.open(whatsappUrl, '_blank');
                });
            }
        });
    </script>
</body>
</html>
